(function(){function c(a,b,c,d){var e=a.length,f=-1;while(++f<e)a[f]=c*a[f]+d*b[f]}function b(a){var b=d3.vector.dot,d=d3.vector.cross,e=d3.vector.length,f=d3.vector.normalize,g=c,h=Array(4),i=Array(3),j=Array(3),k=Array(3),l=Array(3);if(a[3][3]===0)return!1;for(var m=0;m<4;m++)for(var n=0;n<4;n++)a[m][n]/=a[3][3];perspectiveMatrix=a.map(function(a){return a.slice()});for(var m=0;m<3;m++)perspectiveMatrix[m][3]=0;perspectiveMatrix[3][3]=1;if(d3.vector.determinant(perspectiveMatrix)===0)return!1;if(a[0][3]!==0||a[1][3]!==0||a[2][3]!==0){var o=Array(4);o[0]=a[0][3],o[1]=a[1][3],o[2]=a[2][3],o[3]=a[3][3];var p=d3.vector.inverse(perspectiveMatrix),q=d3.vector.transpose(p),h=d3.vector.multiply([o],q);a[0][3]=a[1][3]=a[2][3]=0,a[3][3]=1}else h[0]=h[1]=h[2]=0,h[3]=1;var r=Array(3);r[0]=a[3][0],a[3][0]=0,r[1]=a[3][1],a[3][1]=0,r[2]=a[3][2],a[3][2]=0;for(var m=0;m<3;m++)i[m]=a[m].slice();k[0]=e(i[0]),i[0]=f(i[0]),l[0]=b(i[0],i[1]),g(i[1],i[0],1,-l[0]),k[1]=e(i[1]),i[1]=f(i[1]),l[0]/=k[1],l[1]=b(i[0],i[2]),g(i[2],i[0],1,-l[1]),l[2]=b(i[1],i[2]),g(i[2],i[1],1,-l[2]),k[2]=e(i[2]),i[2]=f(i[2]),l[1]/=k[2],l[2]/=k[2];var s=d(i[1],i[2]);if(b(i[0],s)<0)for(var m=0;m<3;m++)k[0]*=-1,i[m][0]*=-1,i[m][1]*=-1,i[m][2]*=-1;j[1]=Math.asin(-i[0][2]),Math.cos(j[1])!==0?(j[0]=Math.atan2(i[1][2],i[2][2]),j[2]=Math.atan2(i[0][1],i[0][0])):(j[0]=Math.atan2(-i[2][0],i[1][1]),j[2]=0);return{translate:r,perspective:h,rotate:j,scale:k,skew:l}}function a(a){return"matrix3d(1,0,0,0, 0,1,0,0, 0,0,1,0, "+a.perspective.join(",")+")"+"translate3d("+a.translate.join(",")+")"+"rotateX("+a.rotate[0]+")"+"rotateY("+a.rotate[1]+")"+"rotateZ("+a.rotate[2]+")"+"matrix3d(1,0,0,0, 0,1,0,0, 0,"+a.skew[2]+",1,0, 0,0,0,1)"+"matrix3d(1,0,0,0, 0,1,0,0, "+a.skew[1]+",0,1,0, 0,0,0,1)"+"matrix3d(1,0,0,0, "+a.skew[0]+",1,0,0, 0,0,1,0, 0,0,0,1)"+"scale3d("+a.scale.join(",")+")"}d3.vector={},d3.vector.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]},d3.vector.dot=function(a,b){var c=0,d=-1,e=Math.min(a.length,b.length);while(++d<e)c+=a[d]*b[d];return c},d3.vector.length=function(a){return Math.sqrt(d3.vector.dot(a,a))},d3.vector.normalize=function(a){var b=d3.vector.length(a);return a.map(function(a){return a/b})},d3.vector.determinant=function(a){var b=a[0].concat(a[1]).concat(a[2]).concat(a[3]);return b[12]*b[9]*b[6]*b[3]-b[8]*b[13]*b[6]*b[3]-b[12]*b[5]*b[10]*b[3]+b[4]*b[13]*b[10]*b[3]+b[8]*b[5]*b[14]*b[3]-b[4]*b[9]*b[14]*b[3]-b[12]*b[9]*b[2]*b[7]+b[8]*b[13]*b[2]*b[7]+b[12]*b[1]*b[10]*b[7]-b[0]*b[13]*b[10]*b[7]-b[8]*b[1]*b[14]*b[7]+b[0]*b[9]*b[14]*b[7]+b[12]*b[5]*b[2]*b[11]-b[4]*b[13]*b[2]*b[11]-b[12]*b[1]*b[6]*b[11]+b[0]*b[13]*b[6]*b[11]+b[4]*b[1]*b[14]*b[11]-b[0]*b[5]*b[14]*b[11]-b[8]*b[5]*b[2]*b[15]+b[4]*b[9]*b[2]*b[15]+b[8]*b[1]*b[6]*b[15]-b[0]*b[9]*b[6]*b[15]-b[4]*b[1]*b[10]*b[15]+b[0]*b[5]*b[10]*b[15]},d3.vector.gaussjordan=function(a,b){b||(b=1e-10);var c=a.length,d=a[0].length,e=-1,f,g;while(++e<c){var h=e;f=e;while(++f<c)Math.abs(a[f][e])>Math.abs(a[h][e])&&(h=f);var i=a[e];a[e]=a[h],a[h]=i;if(Math.abs(a[e][e])<=b)return!1;f=e;while(++f<c){var j=a[f][e]/a[e][e];g=e-1;while(++g<d)a[f][g]-=a[e][g]*j}}e=c;while(--e>=0){var j=a[e][e];f=-1;while(++f<e){g=d;while(--g>=e)a[f][g]-=a[e][g]*a[f][e]/j}a[e][e]/=j,g=c-1;while(++g<d)a[e][g]/=j}return!0},d3.vector.inverse=function(a){var b=a.length;i=-1;if(b===a[0].length){a=a.map(function(a,c){var d=Array(b),e=-1;while(++e<b)d[e]=c===e?1:0;return a.concat(d)}),d3.vector.gaussjordan(a);while(++i<b)a[i]=a[i].slice(b);return a}},d3.vector.multiply=function(a,b){var c=a.length,d=b[0].length,e=b.length,f=-1,g,h;if(e!==a[0].length)throw{error:"columns(a) != rows(b); "+a[0].length+" != "+e};var i=Array(c);while(++f<c){i[f]=Array(d),g=-1;while(++g<d){var j=0;h=-1;while(++h<e)j+=a[f][h]*b[h][g];i[f][g]=j}}return i},d3.vector.transpose=function(a){var b=a.length,c=a[0].length,d=-1,e,f=Array(c);while(++d<c){f[d]=Array(b),e=-1;while(++e<b)f[d][e]=a[e][d]}return f},d3.vector.interpolate=function(c,d){return d3.interpolateString(a(b(c)),a(b(d)))}})()